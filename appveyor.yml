version: 0.{build}
pull_requests:
  do_not_increment_build_number: true
branches:
  only:
  - master
before_build:
- cmd: nuget restore -verbosity detailed
- set PATH="C:\Program Files (x86)\MSBuild\14.0\Bin";%PATH%
build:
  verbosity: minimal
  publish_nuget: true
  publish_nuget_symbols: true
artifacts:
- path: Influxer\bin\debug
  name: InfluxerDebug
test_script:
- ps: >-
    $source = "https://dl.influxdata.com/influxdb/nightlies/influxdb-nightly_windows_amd64.zip"

    $destination = "$env:Temp\influxdb-nightly_windows_amd64.zip"

    Invoke-WebRequest $source -OutFile $destination

    $x = 7z e $destination -o"$env:Temp\influxdb"

    Start-Process -FilePath "$env:Temp\influxdb\influxd.exe"

    pwd

    vstest.console /logger:Appveyor ".\Influxer.Test\bin\Debug\InfluxerTest.orderedtest"